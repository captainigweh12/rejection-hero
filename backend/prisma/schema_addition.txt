// Add these models to the end of schema.prisma before the last closing brace

model GroupQuest {
  id          String                  @id @default(cuid())
  groupId     String
  questId     String
  createdBy   String                  // User who created this group quest
  assignmentType String               @default("all") // "all" (anyone can join) or "assigned" (specific members)
  createdAt   DateTime                @default(now())
  updatedAt   DateTime                @updatedAt
  group       Group                   @relation(fields: [groupId], references: [id], onDelete: Cascade)
  quest       Quest                   @relation(fields: [questId], references: [id], onDelete: Cascade)
  creator     User                    @relation("GroupQuestCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  participants GroupQuestParticipant[]
  assignments  GroupQuestAssignment[]  // Specific member assignments

  @@map("group_quest")
}

model GroupQuestParticipant {
  id            String      @id @default(cuid())
  groupQuestId  String
  userId        String
  status        String      @default("joined") // joined, in_progress, completed, failed
  noCount       Int         @default(0)
  yesCount      Int         @default(0)
  actionCount   Int         @default(0)
  startedAt     DateTime?
  completedAt   DateTime?
  joinedAt      DateTime    @default(now())
  groupQuest    GroupQuest  @relation(fields: [groupQuestId], references: [id], onDelete: Cascade)
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupQuestId, userId])
  @@map("group_quest_participant")
}

model GroupQuestAssignment {
  id            String      @id @default(cuid())
  groupQuestId  String
  userId        String      // Assigned member
  assignedAt    DateTime    @default(now())
  groupQuest    GroupQuest  @relation(fields: [groupQuestId], references: [id], onDelete: Cascade)
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupQuestId, userId])
  @@map("group_quest_assignment")
}
